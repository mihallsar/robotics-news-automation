name: Test Direct API (No Composio)

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  test-direct-post:
    runs-on: ubuntu-latest
    
    steps:
      - name: Test POST to /api/robots
        run: |
          echo "üîÑ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä—è–º–æ–π POST –∑–∞–ø—Ä–æ—Å..."
          
          RESPONSE=$(curl -X POST https://robototehnika.vercel.app/api/robots \
            -H "Content-Type: application/json" \
            -H "x-api-key: ${{ secrets.ROBOTS_API_KEY }}" \
            -d '{
              "name": "–¢–µ—Å—Ç–æ–≤—ã–π —Ä–æ–±–æ—Ç –∏–∑ GitHub Actions",
              "description": "–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API",
              "category": "–ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Ä–æ–±–æ—Ç",
              "manufacturer": "Test Company",
              "year": 2024,
              "country": "–†–æ—Å—Å–∏—è",
              "price": 50000,
              "official_url": "https://example.com",
              "image_url": "https://robototehnika.vercel.app/test-robot.jpg"
            }' \
            -w "\nHTTP_CODE:%{http_code}" \
            -s)
          
          echo "üìä –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:"
          echo "$RESPONSE"
          
          HTTP_CODE=$(echo "$RESPONSE" | grep "HTTP_CODE:" | cut -d':' -f2)
          echo "üî¢ HTTP –∫–æ–¥: $HTTP_CODE"
          
          if [ "$HTTP_CODE" = "201" ] || [ "$HTTP_CODE" = "200" ]; then
            echo "‚úÖ –£—Å–ø–µ—à–Ω–æ! –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞."
            exit 0
          else
            echo "‚ùå –û—à–∏–±–∫–∞! HTTP –∫–æ–¥: $HTTP_CODE"
            exit 1
          fi

      - name: Test POST to /api/news
        run: |
          echo "üîÑ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ /api/news..."
          
          RESPONSE=$(curl -X POST https://robototehnika.vercel.app/api/news \
            -H "Content-Type: application/json" \
            -H "x-api-key: ${{ secrets.API_KEY }}" \
            -d '{
              "title": "–¢–µ—Å—Ç–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å –∏–∑ GitHub Actions",
              "content": "–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã API –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏. –í—Ä–µ–º—è: '"$(date)"'",
              "image_url": "https://robototehnika.vercel.app/robotics-news.jpg"
            }' \
            -w "\nHTTP_CODE:%{http_code}" \
            -s)
          
          echo "üìä –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:"
          echo "$RESPONSE"
          
          HTTP_CODE=$(echo "$RESPONSE" | grep "HTTP_CODE:" | cut -d':' -f2)
          echo "üî¢ HTTP –∫–æ–¥: $HTTP_CODE"
          
          if [ "$HTTP_CODE" = "201" ] || [ "$HTTP_CODE" = "200" ]; then
            echo "‚úÖ –£—Å–ø–µ—à–Ω–æ! –ù–æ–≤–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∞."
            exit 0
          else
            echo "‚ùå –û—à–∏–±–∫–∞! HTTP –∫–æ–¥: $HTTP_CODE"
            exit 1
          fi
